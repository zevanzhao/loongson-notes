# 国光 UT6500-LA6 3A6000笔记本电脑使用经验

我买了一台国光的3A6000笔记本，这里介绍一些我个人的使用经验。

## 基本参数

笔记本采用龙芯3A6000处理器，4核8线程，主频2.0GHz。单内存条插槽，最大支持单条32GB；存储上支持2TB的固态硬盘。屏幕大小14寸，分辨率1920\*1200。

这个笔记本电脑使用的显卡是7A2000桥片上自带的LG100 GPU, 显存2GB。

整机重量1.7Kg。自带电池容量为65Wh,续航在3小时左右。

笔记本电脑的左侧有4个接口，分别是USB type-C的电源接口，通用 USB type-C接口，HDMI接口以及标准USB接口。左侧还有两个指示灯，分别是电源指示灯以及呼吸灯。

右侧有三个接口，分别是网口、标准USB接口以及3.5mm 音频接口。

笔记本电源开关在键盘的右上角。系统信息显示，该电源开关内置了HOLTEK FocalTech的指纹识别模块，实际上因为没有驱动而不可用。

屏幕上方自带了一颗摄像头，有物理遮光罩可以完整的遮住摄像头。内置无线网卡，也有物理开关可以一键关闭无线网（注：该功能需要操作系统支持）。

此笔记本可以安装银河麒麟、统信UOS操作系统， 也可以安装Loongnix25 等新世界操作系统。如果安装新世界操作系统，需要注意部分硬件驱动可能不可用。

## 优点与缺点

由于采用了3A6000处理器，笔记本性能上基本可以满足日常办公、娱乐以及轻度开发的需求。重量上也基本可以满足移动办公的需求。

缺点分为两类：硬件上的不足以及以及软件生态的不成熟。

硬件上主要有两个缺点。

第一个缺点是功耗过大，以及由此带来的续航时间短、风扇噪音大的问题。功耗大一部分是因为3A6000处理器本身不是专门为移动需求设计的低功耗处理器，虽然已经降频了，最大功耗也有23W左右，待机功耗7W。另外一个原因是因为采用了7A2000桥片，并由其充当显卡。单单一个桥片的功耗就有10W。电池的续航时间只有3个小时，与主流商用产品动辄10小时的续航相比有些太弱了。

第二个缺点是图形显示性能不够，而且驱动只支持到OpenGL 2.1。任何依赖更高版本openGL的应用都无法运行。具体的表现就是，观看B站视频时，如果弹幕很多的话就会非常卡顿；obs studio, 《我的世界》游戏无法运行。

软件生态上的问题，主要的表现是龙芯的商业操作系统都是基于ABI 1.0（旧世界）开发的。而新世界操作系统目前还谈不上成熟。

## 需要注意的其他事项

### 多系统引导问题

理论上讲，磁盘上可以有多个EFI分区，启动的时候可以让用户选择从哪一个EFI分区启动。但国光笔记本电脑只支持从第一个EFI分区引导。统信UOS、银河麒麟等商用操作系统会强制用户使用第一个EFI分区，也是这个原因。

因此，同时安装多个操作系统的时候，多系统引导会成为一个问题。关于这个问题的解决方案，可以参见[三系统共存操作指南](./龙芯3A6000笔记本-三系统共存操作指南.md)。


### 触摸板的使用
当使用Debian官方内核的时候，笔记本的触摸板无法使用。该问题在[这里](https://loongfans.cn/pages/guides/errata-laptop.html)亦有描述。

以Debian 中的 6.17.11内核为例，要解决这个问题，需要进行如下的操作：

* 下载官方源码，并解压缩。
```bash
apt install linux-source-6.17
cd /usr/src/
tar xvfJ linux-source-6.17.tar.xz
cd linux-source-6.17
```

* 修改源码，打上[这里](https://github.com/AOSC-Tracking/linux/commit/e29193f3f1a3)的补丁，添加LS7A GPIO 中断支持

* 配置内核
```bash
cp /boot/config-6.17.11 .config
make menuconfig
```
也可以使用`/usr/src/linux-config-6.17/config.loong64_none_loong64`这个配置文件。
配置的时候，注意需要打开在配置GPIO驱动的时候打开`CONFIG_GPIO_LOONGSON_64BIT=m`，在配置I2C驱动的时候，打开`CONFIG_I2C_LS2X=m`以及 `CONFIG_I2C_HID_ACPI=m`。注意，编译内核的时候不要开启调试选项，否则编译会非常耗时。

完成内核的编译以后，使用新的内核以及内核模块，触摸板就可以驱动了。

关于内核的编译，可以参考[kernel 6.x 内核编译编译](./kernel-compile.md)。

### 系统挂起唤醒问题

使用国光笔记本电脑的时候，如果安装了新世界操作系统，且使用的是上游内核，笔记本电脑挂起到内存以后将无法正常唤醒。Loongnix 25提供的6.6.52版本的内核下，不存在这个问题。

这个问题疑似是笔记本的设计缺陷，可能可以通过升级固件来进行规避。但现阶段3.5版本的固件没有修复这个问题。

这个问题可以被修复，而且应该与显卡驱动一起修复。
具体的流程如下：
* 修正源码，打上[ACPI 板级初始化代码](https://github.com/AOSC-Tracking/linux/commit/dbb668a14178)补丁。
* 打上[这个](https://github.com/AOSC-Tracking/linux/commit/30b69e76d820)补丁，修正PWM控制器的默认频率。
* 打上[这个](https://github.com/AOSC-Tracking/linux/commit/02bbc23d5c6124cf3d0db763501a65736b146092)补丁，修复S3挂起以后无法唤醒的问题。
* 使用[这里](https://github.com/AOSC-Tracking/loonggpu-kernel-dkms/tree/aosc/v1.0.1-alpha-lnd25.5)的Loonggpu驱动。注意，对于3A6000笔记本，需要使用`aosc/v1.0.1-alpha-lnd25.5`这个分支中的代码。关键的补丁是[这个](https://github.com/AOSC-Tracking/loonggpu-kernel-dkms/commit/aaee8cb5d7f879ba4cd2cb268a8591f99735b729)。
* 要单独编译内核驱动，可以使用在loonggpu-kernel-dkms源码目录中运行
```bash
env LG_VERBOSE=1 make -j8 modules KERNEL_UNAME=6.17.11
```
根据你的内核源码版本，修改KENEL_UNAME字符串。

参考：[ABI 2.0 系统搭配 LoongGPU 驱动时背光调整功能不可用](https://loongfans.cn/pages/guides/errata-laptop.html)
### 屏幕亮度调节问题

更新固件到3.5以后，屏幕亮度无法调节。修复显卡驱动以后，亮度调节问题也得到修复。

### KVM虚拟机的使用

如果使用的内核版本是6.6.52, 且qemu版本高于（包含）10.1, 将无法启动KVM虚拟机。最后一个可以使用的KVM虚拟机版本是10.0.3。
要使用更高版本的qemu,需要升级内核版本到6.9以上。

### 无线网物理开关的使用

要使用无线网卡的物理开关，需要在BIOS中进行设置，启用物理开关。

### 固件更新

国光笔记本自带的固件版本为NL38_V2.6, 如果要更新固件，可以下载[固件压缩包](./UT6500-LA6.zip)。
该压缩包内，包含了V2.6以及V3.5两个版本的固件。请按照压缩包内的文档，更新EC固件以及BIOS。

**注意:**

经过本人以及网友测试，上述固件适用于采用NL38主板的国光笔记本电脑以及攀升笔记本电脑。理论上可以安装在其他采用了NL38主板的笔记本电脑上，但这里不做保证。

安装固件的时候，现有固件会对新固件进行验证，如果该固件不适合你的笔记本电脑，系统会拒绝更新固件。
